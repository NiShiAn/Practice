@{
    ViewBag.Title = "文件导入";
}

<h2>文件导入</h2>

<div class="container">
    <form method="post" class="form-inline" id="fileForm" enctype="multipart/form-data">
        <div class="form-group">
            <input type="file" id="myfile" name="myfile" class="form-control" style="width: 300px; display: inline;"/>
        </div>
        <div class="form-group">
            <a class="btn btn-primary" href="~/Temple/山王工业.xlsx">下载模板</a>
        </div>
        <div class="form-group">
            <button type="button" class="btn btn-primary" onclick="pageJs.upload();">导入</button>
        </div>
    </form>
</div>
<br>
<div class="container">
    <table class="table" id="mytable">
    </table>
</div>

<script>
    var pageJs = {
        upload: function() {
            if ($('#myfile')[0].files.length <= 0) {
                alert('未选择文件！');
                return false;
            }
            var checkFile = $('#myfile')[0].files[0];
            if (checkFile.name == "" || checkFile.size > 10000000 || checkFile.name.indexOf(".xls") <= 0) {
                alert('文件限制，必须小于10M的Excel文件！');
                return false;
            }
            //button的type="button",否则默认submit刷新页面
            $("#fileForm").ajaxSubmit({
                type: "POST",
                url: "/Home/ImportExcel",
                success: function (data) {
                    if (data.length > 0) {
                        pageJs.fillTable(JSON.parse(data));
                    }
                    return false;
                },
                error: function (result) {
                    alert(result.responseJSON.msg);
                }
            });
        },
        fillTable: function (list) {
            $("#mytable").empty();
            var html = "";
            for (var i = 0; i < list.length; i++) {
                var obj = list[i];
                if (i == 0) {
                    html += "<tr class='active'>";
                    for (var g in obj) {
                        html += "<th>" + g + "</th>";
                    }
                    html += "</tr>";
                }
                html += "<tr>";
                for (var j in obj) {
                    html += "<td>" + (obj[j] == null ? "" : obj[j]) + "</td>";
                }
                html += "</tr>";
            }
            $("#mytable").append(html);
            $("#mytable").trigger("create");
        }
    }
</script>